{"version":3,"file":"index.cjs.development.cjs","sources":["../src/index.ts"],"sourcesContent":["import indentString, { Options as IIndentOptions } from 'indent-string';\nimport _cleanStack from 'clean-stack';\nimport { inspect } from 'util';\nimport { isIterable } from 'check-iterable';\nimport { array_unique_overwrite } from 'array-hyper-unique';\nimport { getSubErrors } from 'err-errors';\nimport { errStackReduceCore, IOptions as IErrStackReduceOptions } from 'err-stack-reduce';\nimport { stringifyStackMeta } from 'err-stack-meta';\nimport { parseStack } from 'error-stack2';\n\nexport interface IOptions<T = any>\n{\n\terror?: Error;\n\n\thandleStack?(stack: string, error: T): string;\n\n\t/**\n\t * @default 4\n\t */\n\tindent?: number,\n\n\t/**\n\t * options for `indent-string`\n\t */\n\tindentOptions?: IIndentOptions,\n\n\tstackReduceOptions?: IErrStackReduceOptions,\n}\n\nexport type IIterableLike<T = any> = Iterable<T> | IterableIterator<T>;\nexport type IIterableAllowed<T, A extends IIterableLike<T>> = Exclude<A, string | String>;\n\nexport function _isAllowedIterable(arr: any)\n{\n\treturn (typeof arr !== 'string' && !(arr instanceof String) && isIterable(arr))\n}\n\nexport function errorsToMessageList<T, A extends IIterableLike<T> = IIterableLike<T>>(errors: IIterableAllowed<T, A>,\n\toptions?: IOptions<T>,\n\tmainError?: Error,\n)\n{\n\tif (!errors || !_isAllowedIterable(errors))\n\t{\n\t\tthrow new TypeError(`Invalid input errors: ${errors}`)\n\t}\n\n\toptions ??= {};\n\n\tconst { handleStack = (stack: string) => _cleanStack(stack) } = options;\n\n\tmainError ??= options.error;\n\n\tlet _main: string;\n\n\tlet ls: string[] = [];\n\n\tconst stackReduce = errStackReduceCore(mainError, options.stackReduceOptions);\n\n\t(errors as any as (T & Error)[])\n\t\t.forEach((error) =>\n\t\t{\n\t\t\tif (error === void 0 || error === null)\n\t\t\t{\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (mainError === error)\n\t\t\t{\n\t\t\t\t_main = String(error)\n\t\t\t}\n\t\t\telse if (typeof error.stack === 'string')\n\t\t\t{\n\t\t\t\tls.push(handleStack(stringifyStackMeta(stackReduce(error)), error))\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tls.push(inspect(error))\n\t\t\t}\n\n\t\t})\n\t;\n\n\tls = ls.filter(s => s?.length)\n\n\tif (_main?.length)\n\t{\n\t\tls.unshift(_main)\n\t}\n\n\treturn array_unique_overwrite(ls)\n}\n\nexport function indentSubErrorMessage(sub_message: string | IIterableLike<string>, options?: IOptions)\n{\n\tif (_isAllowedIterable(sub_message))\n\t{\n\t\tsub_message = [...sub_message].join('\\n');\n\t}\n\n\toptions ??= {};\n\n\treturn indentString(sub_message as string, options.indent ?? 4, options.indentOptions)\n}\n\nexport function indentSubErrors<T, A extends IIterableLike<T> = IIterableLike<T>>(errors: IIterableAllowed<T, A>,\n\toptions?: IOptions<T>,\n\tmainError?: Error,\n)\n{\n\tconst sub_message = errorsToMessageList(errors, options, mainError);\n\treturn indentSubErrorMessage(sub_message, options);\n}\n\nexport function indentSubErrorsFromError<T, A extends IIterableLike<T> = IIterableLike<T>>(mainError?: Error,\n\toptions?: IOptions<T>,\n)\n{\n\tlet errors = getSubErrors(mainError) as IIterableAllowed<T, A>;\n\n\treturn indentSubErrors(errors, options, mainError)\n}\n\nexport function messageWithSubErrors<T, A extends IIterableLike<T> = IIterableLike<T>>(mainError: Error,\n\terrors?: IIterableAllowed<T, A>,\n\toptions?: IOptions<T>,\n)\n{\n\terrors ??= getSubErrors(mainError) as IIterableAllowed<T, A>;\n\n\tlet _e = parseStack(mainError.stack, mainError.message);\n\n\tlet lines = [] as string[];\n\n\tif (typeof _e.message !== 'undefined')\n\t{\n\t\tlines.push(_e.message);\n\t}\n\n\tlet _em2 = indentSubErrors(errors, options, mainError);\n\n\tif (_em2.length)\n\t{\n\t\tif (lines.length === 0)\n\t\t{\n\t\t\tlines.push('');\n\t\t}\n\t\tlines.push(_em2);\n\t}\n\n\tif (lines.length)\n\t{\n\t\treturn lines.join('\\n')\n\t}\n\n\treturn void 0;\n}\n\nexport default messageWithSubErrors\n"],"names":["_isAllowedIterable","arr","String","isIterable","errorsToMessageList","errors","options","mainError","_options","_mainError","_main2","TypeError","handleStack","stack","_cleanStack","error","_main","ls","stackReduce","errStackReduceCore","stackReduceOptions","forEach","push","stringifyStackMeta","inspect","filter","s","length","unshift","array_unique_overwrite","indentSubErrorMessage","sub_message","_options2","_options$indent","join","indentString","indent","indentOptions","indentSubErrors","indentSubErrorsFromError","getSubErrors","messageWithSubErrors","_errors","_e","parseStack","message","lines","_em2"],"mappings":"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"}