{"version":3,"file":"index.cjs.development.cjs","sources":["../src/util/trim.ts","../src/util/isUnset.ts","../src/util/isNumOnly.ts","../src/index.ts"],"sourcesContent":["export function trim(s: string)\n{\n\treturn s.trim();\n}\n","\nexport function isUnset(v: any): v is undefined | null\n{\n\treturn typeof v === 'undefined' || v === null\n}\n","\nexport function isNumOnly(v: any)\n{\n\tif (typeof v === 'number' || typeof v === 'string')\n\t{\n\t\treturn /^\\d+$/.test(v.toString())\n\t}\n\n\treturn false\n}\n","import { ITSPickExtra, ITSRequireAtLeastOne } from 'ts-type/lib/type/record';\nimport { lineSplit, R_CRLF, LF } from 'crlf-normalize';\nimport { IEvalTrace, IParsed, IParsedWithoutTrace, ISource, ITrace, IRawLineTrace, ITraceValue } from './types';\nimport { stringSplitWithLimit } from 'string-split-keep2';\nimport { trim } from './util/trim';\nimport { isUnset } from './util/isUnset';\nimport { isNumOnly } from './util/isNumOnly';\nimport errcode from 'err-code';\nimport { inspect } from 'util';\nimport { detectIndentLine } from 'string-detect-indent';\n\nconst AT = 'at' as const\n\n// 1.\n// Error: foo\n// 2.\n// TypeError: foo\nconst REGEX_MATCH_MESSAGE = /^([a-z][a-z0-9_]*)(?:(?: \\[(\\w+)\\])?:(?: ([\\s\\S]*))?)?$/i\n\nconst REGEX_MATCH_MESSAGE_LOOSE = new RegExp(REGEX_MATCH_MESSAGE.source, REGEX_MATCH_MESSAGE.flags + 'm');\n\nconst REGEX_REMOVE_AT = /^at\\s+/\nconst REGEX_STARTS_WITH_EVAL_AT = /^eval\\s+at\\s+/\n\nexport function breakBrackets(str: string, first: string, last: string)\n{\n\tif (!str.endsWith(last))\n\t{\n\t\treturn [str]\n\t}\n\n\tlet firstIndex\n\tlet cursor = str.length - 1\n\t// There is already the last one\n\tlet count = 1\n\twhile (--cursor >= 0)\n\t{\n\t\tconst char = str.charAt(cursor)\n\t\tif (char === last)\n\t\t{\n\t\t\tcount++\n\t\t}\n\t\telse if (char === first)\n\t\t{\n\t\t\tif (--count === 0)\n\t\t\t{\n\t\t\t\tfirstIndex = cursor\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [\n\t\tstr.slice(0, firstIndex),\n\t\tstr.slice(firstIndex + 1, -1),\n\t].map(trim)\n}\n\nexport function validPosition(source: {\n\tline?: string | number,\n\tcol?: string | number,\n})\n{\n\tif (!isUnset(source))\n\t{\n\t\tif (typeof source === 'object' && isUnset(source.line) && isUnset(source.col))\n\t\t{\n\t\t\treturn null\n\t\t}\n\n\t\treturn isNumOnly(source.line) && isNumOnly(source.col)\n\t}\n\n\treturn false\n}\n\nexport function parseSource(rawSource: string): ISource\n{\n\tconst [source, line, col] = stringSplitWithLimit(rawSource, ':', -3);\n\n\tif (!col?.length || !line?.length)\n\t{\n\t\treturn {\n\t\t\tsource: rawSource,\n\t\t}\n\t}\n\n\treturn {\n\t\tsource,\n\t\tline,\n\t\tcol,\n\t}\n}\n\nexport function parseEvalSource(rawEvalSource: string): Omit<IEvalTrace, 'callee' | 'calleeNote' | 'eval'>\n{\n\tconst { indent, rawLine } = _detectIndent(rawEvalSource);\n\n\tconst [rawTrace, rawEvalTrace] = rawLine\n\t\t.replace(REGEX_STARTS_WITH_EVAL_AT, '')\n\t\t.split(/,\\s+/g)\n\t\t.map(trim)\n\n\tconst {\n\t\teval: ev,\n\t\tcallee: evalCallee,\n\t\tcalleeNote: evalCalleeNote,\n\t\t...trace\n\t} = parseTrace(rawTrace)\n\n\tconst evalTrace = parseSource(rawEvalTrace)\n\n\treturn {\n\t\tevalCallee,\n\t\tevalCalleeNote,\n\t\t...trace,\n\t\tevalTrace,\n\t\tindent,\n\t}\n}\n\nexport function _detectIndent(trace: string)\n{\n\tconst { indent, body: rawLine } = detectIndentLine(trace);\n\n\treturn {\n\t\tindent,\n\t\trawLine,\n\t}\n}\n\nexport function parseTrace(trace: string, testEvalSource: true): ITrace | IRawLineTrace\nexport function parseTrace(trace: string, testEvalSource?: false): ITrace\nexport function parseTrace(trace: string, testEvalSource?: boolean): ITrace | IRawLineTrace\nexport function parseTrace(trace: string, testEvalSource?: boolean)\n{\n\tconst { indent, rawLine } = _detectIndent(trace);\n\n\tconst t = rawLine.replace(REGEX_REMOVE_AT, '')\n\n\tlet [\n\t\trawCallee, rawSource,\n\t] = breakBrackets(t, '(', ')')\n\n\tif (!rawSource)\n\t{\n\t\t[rawCallee, rawSource] = [rawSource, rawCallee]\n\t}\n\n\tconst ret: ITrace = {} as any\n\n\tif (rawCallee)\n\t{\n\t\tconst [\n\t\t\tcallee, calleeNote,\n\t\t] = breakBrackets(rawCallee, '[', ']')\n\n\t\tret.callee = callee\n\t\tret.calleeNote = calleeNote\n\t}\n\telse\n\t{\n\t\tret.callee = rawCallee\n\t}\n\n\tif (ret.callee === 'eval')\n\t{\n\t\tret.eval = true\n\t}\n\n\tif (testEvalSource === true)\n\t{\n\t\tif (!rawLine.startsWith(AT))\n\t\t{\n\t\t\treturn <IRawLineTrace>{\n\t\t\t\traw: true,\n\t\t\t\tindent,\n\t\t\t\trawLine,\n\t\t\t}\n\t\t}\n\t}\n\n\tObject.assign(\n\t\tret,\n\t\ttestEvalSource && isEvalSource(rawSource)\n\t\t\t? parseEvalSource(rawSource)\n\t\t\t: parseSource(rawSource),\n\t)\n\n\tif (testEvalSource === true)\n\t{\n\t\tif (!validTrace(ret))\n\t\t{\n\t\t\treturn <IRawLineTrace>{\n\t\t\t\traw: true,\n\t\t\t\tindent,\n\t\t\t\trawLine,\n\t\t\t}\n\t\t}\n\t}\n\n\tret.indent = indent\n\n\treturn ret\n}\n\nexport function isEvalSource(rawSource: string)\n{\n\treturn REGEX_STARTS_WITH_EVAL_AT.test(rawSource)\n}\n\nexport function validTrace(trace: ITraceValue)\n{\n\tif (isRawLineTrace(trace))\n\t{\n\t\treturn false;\n\t}\n\n\treturn trace.eval || isNumOnly(trace.line) || isUnset(trace.callee) && trace.source?.length > 0 && validPosition(trace);\n}\n\nexport function parseBody(rawStack: string, detectMessage?: string)\n{\n\tlet rawTrace: string[];\n\tlet rawMessage: string\n\n\tif (!isUnset(detectMessage))\n\t{\n\t\tlet { type, message } = parseMessage(rawStack, true);\n\n\t\tlet mf = formatMessage({\n\t\t\ttype,\n\t\t\tmessage: detectMessage === '' ? message : detectMessage,\n\t\t});\n\n\t\tlet i = rawStack.indexOf(mf)\n\n\t\tif (i === 0)\n\t\t{\n\t\t\tlet s = rawStack.replace(mf, '')\n\t\t\tlet m = R_CRLF.exec(s)\n\n\t\t\tif (m?.index === 0)\n\t\t\t{\n\t\t\t\trawTrace = lineSplit(m.input.replace(m[0], ''));\n\n\t\t\t\trawMessage = mf\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!rawMessage?.length)\n\t{\n\t\t([rawMessage, ...rawTrace] = lineSplit(rawStack));\n\n\t\t// A error message might have multiple lines\n\t\tconst index = rawTrace.findIndex(line => line.trimLeft()\n\t\t\t.startsWith(AT) && validTrace(parseTrace(trim(line), true)));\n\n\t\trawMessage = [rawMessage, ...rawTrace.splice(0, index)].join(LF)\n\t}\n\n\treturn {\n\t\trawMessage,\n\t\trawTrace,\n\t}\n}\n\nexport function parseMessage(body: string, looseMode?: boolean): IParsedWithoutTrace\n{\n\ttry\n\t{\n\t\tconst [, type, code, message] = body.match(looseMode ? REGEX_MATCH_MESSAGE_LOOSE : REGEX_MATCH_MESSAGE);\n\n\t\treturn {\n\t\t\ttype,\n\t\t\tcode,\n\t\t\tmessage,\n\t\t}\n\t}\n\tcatch (e: any)\n\t{\n\t\te.message = `Failed to parse error message.\\nreason: ${e.message}\\nbody=${inspect(body)}`;\n\n\t\terrcode(e, {\n\t\t\tbody,\n\t\t});\n\n\t\tthrow e\n\t}\n}\n\nexport function parseStack(rawStack: string, detectMessage?: string): IParsed\n{\n\tif (typeof rawStack !== 'string')\n\t{\n\t\tthrow errcode(new TypeError('stack must be a string'), {\n\t\t\trawStack,\n\t\t\tdetectMessage,\n\t\t});\n\t}\n\n\ttry\n\t{\n\t\tconst { rawMessage, rawTrace } = parseBody(rawStack, detectMessage);\n\n\t\tconst {\n\t\t\ttype, code, message,\n\t\t} = parseMessage(rawMessage)\n\n\t\tconst traces = rawTrace.map(t => parseTrace(t, true))\n\n\t\treturn {\n\t\t\ttype,\n\t\t\tcode,\n\t\t\tmessage,\n\t\t\ttraces,\n\t\t\trawMessage,\n\t\t\trawTrace,\n\t\t\trawStack,\n\t\t}\n\t}\n\tcatch (e: any)\n\t{\n\t\terrcode(e, {\n\t\t\trawStack,\n\t\t\tdetectMessage,\n\t\t});\n\n\t\tthrow e;\n\t}\n}\n\nexport function formatTrace({\n\tcallee,\n\tcalleeNote,\n\tsource,\n\tline,\n\tcol,\n}: ITSPickExtra<ITrace, 'source'>)\n{\n\tconst sourceTrace = [\n\t\tsource,\n\t\tline,\n\t\tcol,\n\t]\n\t\t.filter(v => typeof v !== 'undefined')\n\t\t.join(':')\n\n\tconst note = calleeNote\n\t\t? ` [${calleeNote}]`\n\t\t: ''\n\n\treturn callee\n\t\t? `${callee}${note} (${sourceTrace})`\n\t\t: sourceTrace\n}\n\nexport function formatEvalTrace({\n\tcallee,\n\tevalTrace,\n\n\tevalCallee,\n\tevalCalleeNote,\n\n\t...trace\n}: IEvalTrace)\n{\n\treturn `${callee} (eval at ${formatTrace({\n\t\t...trace,\n\n\t\tcallee: evalCallee ?? '<anonymous>',\n\t\tcalleeNote: evalCalleeNote,\n\t})}, ${formatTrace(evalTrace)})`;\n}\n\nexport function formatMessagePrefix({\n\ttype,\n\tcode,\n}: IParsedWithoutTrace)\n{\n\tif (code?.length)\n\t{\n\t\ttype += ` [${code}]`;\n\t}\n\n\treturn `${type}`;\n}\n\nexport function formatMessage(parsed: IParsedWithoutTrace)\n{\n\tlet line = formatMessagePrefix(parsed);\n\n\tif (typeof parsed.message !== 'undefined')\n\t{\n\t\tline += `: ${parsed.message ?? ''}`;\n\t}\n\n\treturn line;\n}\n\nexport function formatRawLineTrace(trace: IRawLineTrace)\n{\n\treturn `${trace.indent ?? '    '}${trace.rawLine}`\n}\n\nexport function isRawLineTrace(trace: ITraceValue): trace is IRawLineTrace\n{\n\treturn (trace.raw === true)\n}\n\nexport function isEvalTrace(trace: ITraceValue): trace is IEvalTrace\n{\n\treturn (trace as IEvalTrace).eval === true\n}\n\nexport function formatTraceLine(trace: ITraceValue)\n{\n\tif (isRawLineTrace(trace))\n\t{\n\t\treturn formatRawLineTrace(trace)\n\t}\n\n\treturn `${trace.indent ?? '    '}at ${\n\t\tisEvalTrace(trace)\n\t\t\t? formatEvalTrace(trace)\n\t\t\t: formatTrace(trace)\n\t}`\n}\n\nexport class ErrorStack implements IParsed\n{\n\n\t/**\n\t * Error type\n\t */\n\ttype: string;\n\n\tcode?: string;\n\t/**\n\t * The message used by Error constructor\n\t */\n\tmessage: string;\n\ttraces: IParsed[\"traces\"];\n\n\treadonly rawMessage?: string;\n\treadonly rawTrace?: string[];\n\treadonly rawStack?: string;\n\n\tconstructor(stack: string, detectMessage?: string)\n\t{\n\t\tObject.assign(this, parseStack(stack, detectMessage))\n\t}\n\n\t/**\n\t * filterFunction Function the same as the callback function of Array.prototype.filter(callback)\n\t */\n\tfilter(filter: (value: ITraceValue, index: number, array: IParsed[\"traces\"]) => boolean)\n\t{\n\t\tthis.traces = this.traces.filter(filter)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Format object parsed\n\t */\n\tformat()\n\t{\n\t\treturn stringifyErrorStack(this)\n\t}\n}\n\nexport function formatTraces(traces: IParsed[\"traces\"])\n{\n\treturn traces?.map(formatTraceLine)\n}\n\n/**\n * Format object parsed\n */\nexport function stringifyErrorStack(parsed: ITSRequireAtLeastOne<IParsed, 'traces' | 'rawTrace'>)\n{\n\tconst messageLines = `${formatMessage(parsed)}`\n\tconst tracesLines = (parsed.traces?.map(formatTraceLine) ?? parsed.rawTrace)\n\t\t.join(LF)\n\t;\n\n\treturn tracesLines\n\t\t? messageLines + LF + tracesLines\n\t\t: messageLines\n}\n\nexport function parseErrorStack(stack: string, detectMessage?: string)\n{\n\treturn new ErrorStack(stack, detectMessage)\n}\n\nexport default parseErrorStack\n"],"names":["trim","s","isUnset","v","isNumOnly","test","toString","AT","REGEX_MATCH_MESSAGE","REGEX_MATCH_MESSAGE_LOOSE","RegExp","source","flags","REGEX_REMOVE_AT","REGEX_STARTS_WITH_EVAL_AT","breakBrackets","str","first","last","endsWith","firstIndex","cursor","length","count","char","charAt","slice","map","validPosition","line","col","parseSource","rawSource","stringSplitWithLimit","parseEvalSource","rawEvalSource","indent","rawLine","_detectIndent","rawTrace","rawEvalTrace","replace","split","eval","ev","callee","evalCallee","calleeNote","evalCalleeNote","trace","parseTrace","evalTrace","body","detectIndentLine","testEvalSource","t","rawCallee","ret","startsWith","raw","Object","assign","isEvalSource","validTrace","_trace$source","isRawLineTrace","parseBody","rawStack","detectMessage","_rawMessage","rawMessage","type","message","parseMessage","mf","formatMessage","i","indexOf","m","R_CRLF","exec","index","lineSplit","input","findIndex","trimLeft","splice","join","LF","looseMode","code","match","e","inspect","errcode","parseStack","TypeError","traces","formatTrace","sourceTrace","filter","note","formatEvalTrace","formatMessagePrefix","parsed","_parsed$message","formatRawLineTrace","_trace$indent","isEvalTrace","formatTraceLine","_trace$indent2","ErrorStack","constructor","stack","format","stringifyErrorStack","formatTraces","_parsed$traces$map","_parsed$traces","messageLines","tracesLines","parseErrorStack"],"mappings":"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"}