{"version":3,"file":"index.umd.development.cjs","sources":["../src/util/trim.ts","../src/util/isUnset.ts","../src/util/isNumOnly.ts","../src/index.ts"],"sourcesContent":["export function trim(s: string)\n{\n\treturn s.trim();\n}\n","\nexport function isUnset(v: any): v is undefined | null\n{\n\treturn typeof v === 'undefined' || v === null\n}\n","\nexport function isNumOnly(v: any)\n{\n\tif (typeof v === 'number' || typeof v === 'string')\n\t{\n\t\treturn /^\\d+$/.test(v.toString())\n\t}\n\n\treturn false\n}\n","import { ITSPickExtra, ITSRequireAtLeastOne } from 'ts-type/lib/type/record';\nimport { lineSplit, R_CRLF, LF } from 'crlf-normalize';\nimport { IEvalTrace, IParsed, IParsedWithoutTrace, ISource, ITrace, IRawLineTrace, ITraceValue } from './types';\nimport { stringSplitWithLimit } from 'string-split-keep2';\nimport { trim } from './util/trim';\nimport { isUnset } from './util/isUnset';\nimport { isNumOnly } from './util/isNumOnly';\nimport errcode from 'err-code';\nimport { inspect } from 'util';\nimport { detectIndentLine } from 'string-detect-indent';\n\nconst AT = 'at' as const\n\n// 1.\n// Error: foo\n// 2.\n// TypeError: foo\nconst REGEX_MATCH_MESSAGE = /^([a-z][a-z0-9_]*)(?:(?: \\[(\\w+)\\])?:(?: ([\\s\\S]*))?)?$/i\n\nconst REGEX_MATCH_MESSAGE_LOOSE = new RegExp(REGEX_MATCH_MESSAGE.source, REGEX_MATCH_MESSAGE.flags + 'm');\n\nconst REGEX_REMOVE_AT = /^at\\s+/\nconst REGEX_STARTS_WITH_EVAL_AT = /^eval\\s+at\\s+/\n\nexport function breakBrackets(str: string, first: string, last: string)\n{\n\tif (!str.endsWith(last))\n\t{\n\t\treturn [str]\n\t}\n\n\tlet firstIndex\n\tlet cursor = str.length - 1\n\t// There is already the last one\n\tlet count = 1\n\twhile (--cursor >= 0)\n\t{\n\t\tconst char = str.charAt(cursor)\n\t\tif (char === last)\n\t\t{\n\t\t\tcount++\n\t\t}\n\t\telse if (char === first)\n\t\t{\n\t\t\tif (--count === 0)\n\t\t\t{\n\t\t\t\tfirstIndex = cursor\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [\n\t\tstr.slice(0, firstIndex),\n\t\tstr.slice(firstIndex + 1, -1),\n\t].map(trim)\n}\n\nexport function validPosition(source: {\n\tline?: string | number,\n\tcol?: string | number,\n})\n{\n\tif (!isUnset(source))\n\t{\n\t\tif (typeof source === 'object' && isUnset(source.line) && isUnset(source.col))\n\t\t{\n\t\t\treturn null\n\t\t}\n\n\t\treturn isNumOnly(source.line) && isNumOnly(source.col)\n\t}\n\n\treturn false\n}\n\nexport function parseSource(rawSource: string): ISource\n{\n\tconst [source, line, col] = stringSplitWithLimit(rawSource, ':', -3);\n\n\tif (!col?.length || !line?.length)\n\t{\n\t\treturn {\n\t\t\tsource: rawSource,\n\t\t}\n\t}\n\n\treturn {\n\t\tsource,\n\t\tline,\n\t\tcol,\n\t}\n}\n\nexport function parseEvalSource(rawEvalSource: string): Omit<IEvalTrace, 'callee' | 'calleeNote' | 'eval'>\n{\n\tconst { indent, rawLine } = _detectIndent(rawEvalSource);\n\n\tconst [rawTrace, rawEvalTrace] = rawLine\n\t\t.replace(REGEX_STARTS_WITH_EVAL_AT, '')\n\t\t.split(/,\\s+/g)\n\t\t.map(trim)\n\n\tconst {\n\t\teval: ev,\n\t\tcallee: evalCallee,\n\t\tcalleeNote: evalCalleeNote,\n\t\t...trace\n\t} = parseTrace(rawTrace)\n\n\tconst evalTrace = parseSource(rawEvalTrace)\n\n\treturn {\n\t\tevalCallee,\n\t\tevalCalleeNote,\n\t\t...trace,\n\t\tevalTrace,\n\t\tindent,\n\t}\n}\n\nexport function _detectIndent(trace: string)\n{\n\tconst { indent, body: rawLine } = detectIndentLine(trace);\n\n\treturn {\n\t\tindent,\n\t\trawLine,\n\t}\n}\n\nexport function parseTrace(trace: string, testEvalSource: true): ITrace | IRawLineTrace\nexport function parseTrace(trace: string, testEvalSource?: false): ITrace\nexport function parseTrace(trace: string, testEvalSource?: boolean): ITrace | IRawLineTrace\nexport function parseTrace(trace: string, testEvalSource?: boolean)\n{\n\tconst { indent, rawLine } = _detectIndent(trace);\n\n\tconst t = rawLine.replace(REGEX_REMOVE_AT, '')\n\n\tlet [\n\t\trawCallee, rawSource,\n\t] = breakBrackets(t, '(', ')')\n\n\tif (!rawSource)\n\t{\n\t\t[rawCallee, rawSource] = [rawSource, rawCallee]\n\t}\n\n\tconst ret: ITrace = {} as any\n\n\tif (rawCallee)\n\t{\n\t\tconst [\n\t\t\tcallee, calleeNote,\n\t\t] = breakBrackets(rawCallee, '[', ']')\n\n\t\tret.callee = callee\n\t\tret.calleeNote = calleeNote\n\t}\n\telse\n\t{\n\t\tret.callee = rawCallee\n\t}\n\n\tif (ret.callee === 'eval')\n\t{\n\t\tret.eval = true\n\t}\n\n\tif (testEvalSource === true)\n\t{\n\t\tif (!rawLine.startsWith(AT))\n\t\t{\n\t\t\treturn <IRawLineTrace>{\n\t\t\t\traw: true,\n\t\t\t\tindent,\n\t\t\t\trawLine,\n\t\t\t}\n\t\t}\n\t}\n\n\tObject.assign(\n\t\tret,\n\t\ttestEvalSource && isEvalSource(rawSource)\n\t\t\t? parseEvalSource(rawSource)\n\t\t\t: parseSource(rawSource),\n\t)\n\n\tif (testEvalSource === true)\n\t{\n\t\tif (!validTrace(ret))\n\t\t{\n\t\t\treturn <IRawLineTrace>{\n\t\t\t\traw: true,\n\t\t\t\tindent,\n\t\t\t\trawLine,\n\t\t\t}\n\t\t}\n\t}\n\n\tret.indent = indent\n\n\treturn ret\n}\n\nexport function isEvalSource(rawSource: string)\n{\n\treturn REGEX_STARTS_WITH_EVAL_AT.test(rawSource)\n}\n\nexport function validTrace(trace: ITraceValue)\n{\n\tif (isRawLineTrace(trace))\n\t{\n\t\treturn false;\n\t}\n\n\treturn trace.eval || isNumOnly(trace.line) || isUnset(trace.callee) && trace.source?.length > 0 && validPosition(trace);\n}\n\nexport function parseBody(rawStack: string, detectMessage?: string)\n{\n\tlet rawTrace: string[];\n\tlet rawMessage: string\n\n\tif (!isUnset(detectMessage))\n\t{\n\t\tlet { type, message } = parseMessage(rawStack, true);\n\n\t\tlet mf = formatMessage({\n\t\t\ttype,\n\t\t\tmessage: detectMessage === '' ? message : detectMessage,\n\t\t});\n\n\t\tlet i = rawStack.indexOf(mf)\n\n\t\tif (i === 0)\n\t\t{\n\t\t\tlet s = rawStack.replace(mf, '')\n\t\t\tlet m = R_CRLF.exec(s)\n\n\t\t\tif (m?.index === 0)\n\t\t\t{\n\t\t\t\trawTrace = lineSplit(m.input.replace(m[0], ''));\n\n\t\t\t\trawMessage = mf\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!rawMessage?.length)\n\t{\n\t\t([rawMessage, ...rawTrace] = lineSplit(rawStack));\n\n\t\t// A error message might have multiple lines\n\t\tconst index = rawTrace.findIndex(line => line.trimLeft()\n\t\t\t.startsWith(AT) && validTrace(parseTrace(trim(line), true)));\n\n\t\trawMessage = [rawMessage, ...rawTrace.splice(0, index)].join(LF)\n\t}\n\n\treturn {\n\t\trawMessage,\n\t\trawTrace,\n\t}\n}\n\nexport function parseMessage(body: string, looseMode?: boolean): IParsedWithoutTrace\n{\n\ttry\n\t{\n\t\tconst [, type, code, message] = body.match(looseMode ? REGEX_MATCH_MESSAGE_LOOSE : REGEX_MATCH_MESSAGE);\n\n\t\treturn {\n\t\t\ttype,\n\t\t\tcode,\n\t\t\tmessage,\n\t\t}\n\t}\n\tcatch (e: any)\n\t{\n\t\te.message = `Failed to parse error message.\\nreason: ${e.message}\\nbody=${inspect(body)}`;\n\n\t\terrcode(e, {\n\t\t\tbody,\n\t\t});\n\n\t\tthrow e\n\t}\n}\n\nexport function parseStack(rawStack: string, detectMessage?: string): IParsed\n{\n\tif (typeof rawStack !== 'string')\n\t{\n\t\tthrow errcode(new TypeError('stack must be a string'), {\n\t\t\trawStack,\n\t\t\tdetectMessage,\n\t\t});\n\t}\n\n\ttry\n\t{\n\t\tconst { rawMessage, rawTrace } = parseBody(rawStack, detectMessage);\n\n\t\tconst {\n\t\t\ttype, code, message,\n\t\t} = parseMessage(rawMessage)\n\n\t\tconst traces = rawTrace.map(t => parseTrace(t, true))\n\n\t\treturn {\n\t\t\ttype,\n\t\t\tcode,\n\t\t\tmessage,\n\t\t\ttraces,\n\t\t\trawMessage,\n\t\t\trawTrace,\n\t\t\trawStack,\n\t\t}\n\t}\n\tcatch (e: any)\n\t{\n\t\terrcode(e, {\n\t\t\trawStack,\n\t\t\tdetectMessage,\n\t\t});\n\n\t\tthrow e;\n\t}\n}\n\nexport function formatTrace({\n\tcallee,\n\tcalleeNote,\n\tsource,\n\tline,\n\tcol,\n}: ITSPickExtra<ITrace, 'source'>)\n{\n\tconst sourceTrace = [\n\t\tsource,\n\t\tline,\n\t\tcol,\n\t]\n\t\t.filter(v => typeof v !== 'undefined')\n\t\t.join(':')\n\n\tconst note = calleeNote\n\t\t? ` [${calleeNote}]`\n\t\t: ''\n\n\treturn callee\n\t\t? `${callee}${note} (${sourceTrace})`\n\t\t: sourceTrace\n}\n\nexport function formatEvalTrace({\n\tcallee,\n\tevalTrace,\n\n\tevalCallee,\n\tevalCalleeNote,\n\n\t...trace\n}: IEvalTrace)\n{\n\treturn `${callee} (eval at ${formatTrace({\n\t\t...trace,\n\n\t\tcallee: evalCallee ?? '<anonymous>',\n\t\tcalleeNote: evalCalleeNote,\n\t})}, ${formatTrace(evalTrace)})`;\n}\n\nexport function formatMessagePrefix({\n\ttype,\n\tcode,\n}: IParsedWithoutTrace)\n{\n\tif (code?.length)\n\t{\n\t\ttype += ` [${code}]`;\n\t}\n\n\treturn `${type}`;\n}\n\nexport function formatMessage(parsed: IParsedWithoutTrace)\n{\n\tlet line = formatMessagePrefix(parsed);\n\n\tif (typeof parsed.message !== 'undefined')\n\t{\n\t\tline += `: ${parsed.message ?? ''}`;\n\t}\n\n\treturn line;\n}\n\nexport function formatRawLineTrace(trace: IRawLineTrace)\n{\n\treturn `${trace.indent ?? '    '}${trace.rawLine}`\n}\n\nexport function isRawLineTrace(trace: ITraceValue): trace is IRawLineTrace\n{\n\treturn (trace.raw === true)\n}\n\nexport function isEvalTrace(trace: ITraceValue): trace is IEvalTrace\n{\n\treturn (trace as IEvalTrace).eval === true\n}\n\nexport function formatTraceLine(trace: ITraceValue)\n{\n\tif (isRawLineTrace(trace))\n\t{\n\t\treturn formatRawLineTrace(trace)\n\t}\n\n\treturn `${trace.indent ?? '    '}at ${\n\t\tisEvalTrace(trace)\n\t\t\t? formatEvalTrace(trace)\n\t\t\t: formatTrace(trace)\n\t}`\n}\n\nexport class ErrorStack implements IParsed\n{\n\n\t/**\n\t * Error type\n\t */\n\ttype: string;\n\n\tcode?: string;\n\t/**\n\t * The message used by Error constructor\n\t */\n\tmessage: string;\n\ttraces: IParsed[\"traces\"];\n\n\treadonly rawMessage?: string;\n\treadonly rawTrace?: string[];\n\treadonly rawStack?: string;\n\n\tconstructor(stack: string, detectMessage?: string)\n\t{\n\t\tObject.assign(this, parseStack(stack, detectMessage))\n\t}\n\n\t/**\n\t * filterFunction Function the same as the callback function of Array.prototype.filter(callback)\n\t */\n\tfilter(filter: (value: ITraceValue, index: number, array: IParsed[\"traces\"]) => boolean)\n\t{\n\t\tthis.traces = this.traces.filter(filter)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Format object parsed\n\t */\n\tformat()\n\t{\n\t\treturn stringifyErrorStack(this)\n\t}\n}\n\nexport function formatTraces(traces: IParsed[\"traces\"])\n{\n\treturn traces?.map(formatTraceLine)\n}\n\n/**\n * Format object parsed\n */\nexport function stringifyErrorStack(parsed: ITSRequireAtLeastOne<IParsed, 'traces' | 'rawTrace'>)\n{\n\tconst messageLines = `${formatMessage(parsed)}`\n\tconst tracesLines = (parsed.traces?.map(formatTraceLine) ?? parsed.rawTrace)\n\t\t.join(LF)\n\t;\n\n\treturn tracesLines\n\t\t? messageLines + LF + tracesLines\n\t\t: messageLines\n}\n\nexport function parseErrorStack(stack: string, detectMessage?: string)\n{\n\treturn new ErrorStack(stack, detectMessage)\n}\n\nexport default parseErrorStack\n"],"names":["trim","s","isUnset","v","isNumOnly","test","toString","AT","REGEX_MATCH_MESSAGE","REGEX_MATCH_MESSAGE_LOOSE","RegExp","source","flags","REGEX_REMOVE_AT","REGEX_STARTS_WITH_EVAL_AT","breakBrackets","str","first","last","endsWith","firstIndex","cursor","length","count","char","charAt","slice","map","validPosition","line","col","parseSource","rawSource","stringSplitWithLimit","parseEvalSource","rawEvalSource","indent","rawLine","_detectIndent","rawTrace","rawEvalTrace","replace","split","eval","ev","callee","evalCallee","calleeNote","evalCalleeNote","trace","parseTrace","evalTrace","body","detectIndentLine","testEvalSource","t","rawCallee","ret","startsWith","raw","Object","assign","isEvalSource","validTrace","_trace$source","isRawLineTrace","parseBody","rawStack","detectMessage","_rawMessage","rawMessage","type","message","parseMessage","mf","formatMessage","i","indexOf","m","R_CRLF","exec","index","lineSplit","input","findIndex","trimLeft","splice","join","LF","looseMode","code","match","e","inspect","errcode","parseStack","TypeError","traces","formatTrace","sourceTrace","filter","note","formatEvalTrace","formatMessagePrefix","parsed","_parsed$message","formatRawLineTrace","_trace$indent","isEvalTrace","formatTraceLine","_trace$indent2","ErrorStack","constructor","stack","format","stringifyErrorStack","formatTraces","_parsed$traces$map","_parsed$traces","messageLines","tracesLines","parseErrorStack"],"mappings":"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"}