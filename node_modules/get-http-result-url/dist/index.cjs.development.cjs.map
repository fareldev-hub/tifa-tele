{"version":3,"file":"index.cjs.development.cjs","sources":["../src/index.ts"],"sourcesContent":["import { LazyURL } from 'lazy-url';\nimport type { ClientRequest } from 'http';\nimport { LazyURLSearchParams } from 'http-form-urlencoded';\n\nexport interface IReqInfo\n{\n\tprotocol?: string\n\tauth?: string\n\thostname?: string\n\tport?: string\n\tpathname?: string\n\tsearch?: string\n}\n\nexport interface IOptions\n{\n\tignoreError?: boolean\n\tresponse?: any\n}\n\nexport function resultToURL<T extends {\n\trequest?: any;\n}>(result: T, options?: IOptions, res?: any)\n{\n\treturn requestToURL(result?.request, options, res ?? options?.response ?? result)\n}\n\nexport function requestToURL(req: any, options?: IOptions, res?: any)\n{\n\ttry\n\t{\n\t\treturn new LazyURL(req.url ?? req.res?.responseUrl ?? _requestToURL(req, res ?? options?.response))\n\t}\n\tcatch (e)\n\t{\n\t\tif (!options?.ignoreError)\n\t\t{\n\t\t\tthrow e\n\t\t}\n\t}\n}\n\nexport function _requestToURL(req: any, res: any)\n{\n\tlet href: string | URL = req._currentUrl;\n\tlet _currentRequest: ClientRequest = req._currentRequest ?? req ?? {};\n\tlet _options: IReqInfo = req._options ?? {};\n\tres ??= {};\n\n\tif (_options.protocol?.length)\n\t{\n\t\tlet u: LazyURL;\n\n\t\tif (_options.protocol && _options.hostname)\n\t\t{\n\t\t\tu = new LazyURL(_options.protocol + '//' + _options.hostname);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tu = new LazyURL(_currentRequest.path);\n\t\t}\n\n\t\tu.set('protocol', _options.protocol ?? _currentRequest.protocol);\n\t\tu.set('port', _options.port);\n\t\tu.set('pathname', _options.pathname ?? _currentRequest.path);\n\t\tu.set('query', _options.search);\n\t\tu.set('auth', _options.auth);\n\t\tu.set('hostname', _options.hostname ?? _currentRequest.getHeader?.('Host') as string ?? _currentRequest.host);\n\n\t\thref = u;\n\t}\n\telse if (typeof _currentRequest.getHeader === 'function')\n\t{\n\t\tlet u = new LazyURL(req.protocol + '//' + _currentRequest.getHeader('Host') ?? _currentRequest.host);\n\n\t\tu.pathname = req.path;\n\t\tu.protocol = req.protocol;\n\n\t\thref = u;\n\t}\n\telse if (!href && res.config?.url)\n\t{\n\t\thref = new LazyURL(res.config.url, res.config.baseURL);\n\n\t\tif (typeof res.config.params !== 'undefined')\n\t\t{\n\t\t\tlet sp = new LazyURLSearchParams(res.config.params);\n\t\t\tsp.forEach((value, key) => {\n\t\t\t\t(href as LazyURL).searchParams.set(key, value);\n\t\t\t})\n\t\t}\n\t}\n\n\treturn new LazyURL(href)\n}\n\nexport default requestToURL\n"],"names":["requestToURL","result","request","options","_ref","res","response","req","LazyURL","_ref2","_req$url","url","_req$res","responseUrl","_requestToURL","e","ignoreError","_currentUrl","_ref3","_req$_currentRequest","_currentRequest","_req$_options","_options","_res","hostname","path","_options$protocol2","protocol","u","set","port","_options$pathname","pathname"],"mappings":";;;;;;;;;AAAA,EAAA,OAAAA,YAAA,CAAAC,MAAA,KAAA,IAAA,IAAAA,MAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,MAAA,CAAAC,OAAmC,EAAAC,OAAA,EAAAC,CAAAA,IAAA,GAAAC,GAAA,KAAA,IAAA,IAAAA,GAAA,KAAA,KAAA,CAAA,GAAAA,GAAA,GAAAF,OAAA,KAAA,IAAA,IAAAA,OAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAA,CAAAG,QAAA,MAAAF,IAAAA,IAAAA,IAAA,KAAAA,KAAAA,CAAAA,GAAAA,IAAA,GAAAH,MAAA,CAAA,CAAA;AAoBnC,CAAA;AA6BC,SAAYD,YAIPA,CAAAO,GAAA,EAAAJ,OAA8B,EAAAE,GAAA,EAAA;;;WAGlC,IAAAG,eAAC,CAAAC,CAAAA,KAAA,IAAAC,QAAA,GAAAH,GAAA,CAAAI,GAAA,MAAA,IAAA,IAAAD,QAAA,KAAAA,KAAAA,CAAAA,GAAAA,QAAA,IAAAE,QAAA,GAAAL,GAAA,CAAAF,GAAA,MAAAO,IAAAA,IAAAA,QAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,QAAA,CAAAC,WAAA,MAAA,IAAA,IAAAJ,KAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAA,GAAAK,aAAA,CAAAP,GAAA,EAAAF,GAAA,KAAA,IAAA,IAAAA,GAAA,KAAAA,KAAAA,CAAAA,GAAAA,GAAA,GAAAF,OAAA,KAAA,IAAA,IAAAA,OAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAA,CAAAG,QAAA,CAAA,CAAA,CAAA;IAPF,OAAAS,CAAA,EAAA;QAWE,EAAAZ,OAAA,KAAAA,IAAAA,IAAAA,OAAA,eAAAA,OAAA,CAAAa,WAAA,CAAA,EAAA;;AAID,KAAA;;;;;UAMA,GAAAT,GAAA,CAAAU,WAAA,CAAA;AAGI,EAAA,IAAA,eAAA,GAAA,CAAAC,KAAA,GAAAC,CAAAA,oBAAA,GAAAZ,GAAA,CAAAa,eAAA,MAAA,IAAA,IAAAD,oBAAA,KAAA,KAAA,CAAA,GAAAA,oBAAA,GAAAZ,GAAA,MAAAW,IAAAA,IAAAA,KAAA,cAAAA,KAAA,GAAA,EAAA,CAAA;cAEJ,GAAAG,CAAAA,aAAA,GAAAd,GAAA,CAAAe,QAAA,MAAAD,IAAAA,IAAAA,aAAA,cAAAA,aAAA,GAAA,EAAA,CAAA;AACA,EAAA,CAAA,IAAA,GAAA,GAAA,MAAA,IAAA,IAAAE,IAAA,KAAA,KAAA,CAAA,GAAAA,IAAA,MAAA,GAAA,EAAA,CAAA;;;;yBAKA,IAAAD,QAAA,CAAAE,QAAA,EAAA;;;UAMG,oBAAeJ,eAAS,CAAAK,IAAA,CAAA,CAAA;;oBAG1B,EAAAC,CAAAA,kBAAA,GAAAJ,QAAA,CAAAK,QAAA,MAAA,IAAA,IAAAD,kBAAA,KAAAA,KAAAA,CAAAA,GAAAA,kBAAA,GAAAN,eAAA,CAAAO,QAAA,CAAA,CAAA;AAGFC,IAAAA,CAAA,CAAAC,GAAW,CAAA,MAAAP,EAAAA,QAAA,CAAAQ,IAAA,CAAA,CAAA;AAGZF,IAAAA,CAAA,CAAAC,GAAA,CAAA,UAAe,EAAAE,CAAAA,iBAAA,GAAAT,QAAY,CAAAU,QAAA,MAAA,IAAA,IAAAD,iBAAA,KAAAA,KAAAA,CAAAA,GAAAA,iBAAA,GAAAX;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}